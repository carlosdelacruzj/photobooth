<ion-content class="ion-padding page config-page" scrollY="true">
  <ion-toast
    [isOpen]="!!errorMessage"
    [message]="errorMessage"
    duration="2000"
    (didDismiss)="errorMessage = ''"
  ></ion-toast>
  <div class="hero safe-top">
    <h2>Photobooth</h2>
    <p>Temporizador y camara antes de empezar.</p>
  </div>

  <ion-card class="panel">
    <ion-card-header>
      <ion-card-title>Ajustes</ion-card-title>
    </ion-card-header>
    <ion-card-content>
      <ion-list lines="none">
        <ion-item>
      <ion-label>Segundos por foto: {{ secondsPerShot }}</ion-label>
      <ion-range
        min="1"
        max="10"
        step="1"
        [(ngModel)]="secondsPerShot"
      ></ion-range>
    </ion-item>

    <ion-item>
      <ion-label>Camara frontal</ion-label>
      <ion-toggle [(ngModel)]="useFrontCamera"></ion-toggle>
    </ion-item>
      </ion-list>
    </ion-card-content>
  </ion-card>

  <ion-card class="panel">
    <ion-card-header>
      <ion-card-title>Fondos</ion-card-title>
    </ion-card-header>
    <ion-card-content>
      <ion-button expand="block">
        <label class="file-button">
          Agregar fondo
          <input
            type="file"
            accept="image/*"
            (change)="onBackgroundSelected($event)"
          />
        </label>
      </ion-button>
      <ion-button expand="block" color="medium" (click)="selectBackground(null)">
        Sin fondo
      </ion-button>

      <div *ngIf="backgroundGallery.length > 0; else noBackground">
        <div class="gallery">
          <div
            *ngFor="let item of backgroundGallery"
            class="gallery-item"
            [class.selected]="selectedBackgroundId === item.id"
            (click)="selectBackground(item.id)"
          >
            <img [src]="item.dataUrl" alt="Fondo" />
            <ion-button
              size="small"
              color="danger"
              expand="block"
              (click)="removeBackground(item.id); $event.stopPropagation()"
            >
              Eliminar
            </ion-button>
          </div>
        </div>
      </div>
      <ng-template #noBackground>
        <p class="muted">No hay fondos guardados.</p>
      </ng-template>
    </ion-card-content>
  </ion-card>

  <ion-card class="panel">
    <ion-card-header>
      <ion-card-title>Vista previa</ion-card-title>
    </ion-card-header>
    <ion-card-content>
      <canvas #previewCanvas class="preview-canvas"></canvas>
      <ion-button expand="block" color="medium" (click)="openPreview()">
        Probar plantilla
      </ion-button>
    </ion-card-content>
  </ion-card>

  <ion-button expand="block" class="primary-action" (click)="start()">
    Empezar
  </ion-button>
</ion-content>

<ion-modal [isOpen]="isPreviewOpen" (didDismiss)="closePreview()">
  <ng-template>
    <ion-header>
      <ion-toolbar class="page-toolbar">
        <ion-title>Vista previa</ion-title>
        <ion-buttons slot="end">
          <ion-button (click)="closePreview()">Cerrar</ion-button>
        </ion-buttons>
      </ion-toolbar>
    </ion-header>
    <ion-content class="ion-padding page">
      <canvas #fullPreviewCanvas class="preview-canvas full"></canvas>
    </ion-content>
  </ng-template>
</ion-modal>
